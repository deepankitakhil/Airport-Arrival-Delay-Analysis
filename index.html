<!DOCTYPE html>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<script src="http://d3js.org/d3.v4.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>
<style type="text/css">

    .states {
        fill: #e5e5e5;
        stroke: #fff;
        stroke-width: 1px;
    }

    .cities {
        fill: red;
        fill-opacity: 0.5;
        stroke: #fff;
        stroke-width: 2px;
    }

</style>
<body>

<script>

    var width = 1200,
        height = 1000;

    var svg = d3.select('body').append('svg')
        .attr('width', width)
        .attr('height', height);

    var projection = d3.geoAlbers()
        .scale(1100)
        .translate([(width >> 1), (height >> 1)]);

    var path = d3.geoPath()
        .projection(projection);

    queue()
        .defer(d3.json, '/Airport-Arrival-Delay-Analysis/data/states.json')
        .defer(d3.json, '/Airport-Arrival-Delay-Analysis/data/top200airports.json')
        .await(createMap);

    function createMap(error, states, airport_data) {

        var airport_length = airport_data.features.length;
        var passenger_traffic = [];
        for (var index = 0; index < airport_length; index++) {
            var pop = airport_data.features[index].properties.TOT_ENP;
            passenger_traffic.push(Number(pop));
        }

        var min_passenger_value = Math.min.apply(Math, passenger_traffic);
        var max_passenger_value = Math.max.apply(Math, passenger_traffic);

        var airport_radius = d3.scaleQuantile()
            .domain([min_passenger_value, max_passenger_value])
            .range([10, 30]);

        svg.selectAll("path")
            .data(states.features)
            .enter()
            .append("path")
            .attr("d", path)
            .style("fill", "steelblue");

        svg.selectAll('.cities')
            .data(airport_data.features)
            .enter()
            .append('path')
            .attr("d", path.pointRadius(function (d) {
                return airport_radius(d.properties.TOT_ENP);
            }))
            .attr('class', 'cities');

    }

</script>
</body>